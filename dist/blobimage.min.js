!function(){function e(n){return this instanceof e?(this.url=n,this.element=new Image,this.blob=null,this.blobURL=null,this.onload=function(){},void this.load()):new e(n)}var n=window.Blob||window.WebkitBlob,t=window.URL||window.webkitURL;e.prototype.load=function(){var e=this,i=new XMLHttpRequest;i.responseType="arraybuffer",i.open("GET",e.url,!0),i.onload=function(){var o=new Uint8Array(this.response),r=i.getResponseHeader("Content-Type");r=r?r.split(";")[0]:"image/jpeg",e.blob=new n([o],{type:r});var a=t.createObjectURL(e.blob);e.blobURL=e.element.src=a,e.onload()},i.onerror=function(e){return console.error(e.error)},i.send()},e.prototype.toDataURL=function(e){var n=new window.FileReader;n.onloadend=function(){var t=n.result;return e(null,t)},n.onerror=e,n.readAsDataURL(this.blob)},e.prototype.release=function(){t.revokeObjectURL(this.blobURL)};var i="undefined"!=typeof define;i&&define.amd?define(function(){return e}):this.BlobImage=e}(),function(){if("undefined"==typeof min)throw new Error("MinDB is required.");if("undefined"==typeof BlobImage)throw new Error("BlobImage is required.");var e={images:{},addImage:function(e){var n=Math.random().toString(32).substr(2);return e.id=n,this.images[n]=e,n},createImage:function(e){var n=new BlobImage(e);return this.addImage(n),n},storeImageCache:function(e,n){var t=this,i=t.images[e];i.toDataURL(function(e,t){return e?n(e):void min.multi().sadd("img-caches",i.id).set("img-cache:"+i.id,t).exec(n)})},getImageCache:function(e,n){var t=this;min.sismember("img-caches",e).then(function(t){return 1==t?min.get("img-cache:"+e):n(new Error("Image cache not found"))}).then(function(i){var o=new BlobImage(i);t.images[e]=o,n(null,o)},n)},removeImage:function(e){var n=this;n.removeImageCache(e,function(t){if(t&&console.error(t),n.images[e]){var i=n.images[e];i.release(),delete n.images[e]}})},removeImageCache:function(e,n){min.multi().srem("img-caches",e).del("img-cache:"+e).exec(n)}},n="undefined"!=typeof define;n&&define.amd?define(function(){return e}):this.BlobImageManager=e}();
//# sourceMappingURL=blobimage.min.js.map